/*
Kache - a cross-browser LocalStorage API
https://github.com/leveille/kache
*/((function(){var a,b,c,d,e,f,g,h,i,j,k,l,m,n,o,p=Object.prototype.hasOwnProperty,q=Array.prototype.slice,r=Array.prototype.indexOf||function(a){for(var b=0,c=this.length;b<c;b++)if(b in this&&this[b]===a)return b;return-1},s=function(a,b){function d(){this.constructor=a}for(var c in b)p.call(b,c)&&(a[c]=b[c]);return d.prototype=b.prototype,a.prototype=new d,a.__super__=b.prototype,a};l=typeof exports!="undefined"&&exports!==null?exports:this,n="0.0.1",i=function(a){return typeof a=="number"&&isFinite(a)},h=function(a){return a&&a.e&&a.e<m()},k=function(){},m=function(){return+(new Date)},g=function(a){var b,c,d;d=0;for(b in a){if(!p.call(a,b))continue;c=a[b],d++}return d},l.KacheConfig==null&&(l.KacheConfig={enabled:!1,defaultTimeout:0}),(o=l.KacheConfig).Timeouts==null&&(o.Timeouts={}),c={trace:!0,logPrefix:"(Kache)",log:function(){var a;a=1<=arguments.length?q.call(arguments,0):[];if(!this.trace)return;if(typeof console=="undefined")return;return this.logPrefix&&a.unshift(this.logPrefix),console.log.apply(console,a),this}},j=["included","extended"],e=function(){function a(){}return a.include=function(a){var b,c,d;if(!a)throw"include(obj) requires obj";for(c in a)d=a[c],r.call(j,c)<0&&(this.prototype[c]=d);return b=a.included,b&&b.apply(this),this},a.extend=function(a){var b,c,d;if(!a)throw"extend(obj) requires obj";for(c in a)d=a[c],r.call(j,c)<0&&(this[c]=d);return b=a.extended,b&&b.apply(this),this},a.proxy=function(a){var b=this;return function(){return a.apply(b,arguments)}},a.prototype.proxy=function(a){var b=this;return function(){return a.apply(b,arguments)}},a}(),f=function(a){function b(a,b,c){this.namespace=a,this.timeout=b,this.atts=c;if(!this._)throw"Invalid Cache Instance";l.KacheConfig&&(l.KacheConfig.Timeouts&&l.KacheConfig.Timeouts[this.namespace]?b=l.KacheConfig.Timeouts[this.namespace]:l.KacheConfig.defaultTimeout?b=l.KacheConfig.defaultTimeout:b=0),this.timeout==null&&(this.timeout=b),c&&this.load(c)}return s(b,a),b.include(c),b.prototype.clear=function(){return this._={},this.writeThrough(),this},b.prototype.clearExpired=function(a){return h(this._[a])&&this.remove(a),this},b.prototype.clearExpireds=function(){var a,b,c;c=this._;for(b in c)a=c[b],this.clearExpired(b);return this},b.prototype.count=function(){return this.clearExpireds(),g(this._)},b.prototype.dump=function(){return this.log(this._),this},b.prototype.enabled=function(){throw"NotImplemented exception"},b.prototype.error=function(a){return this.log(a)},b.prototype.get=function(a){if(!this.enabled())return;this.clearExpired(a);if(this._[a]&&this._[a].v)return this._[a].v},b.prototype.load=function(a){var b,c,d;d=[];for(b in a)c=a[b],d.push(this[b]=c);return d},b.prototype.remove=function(a){return delete this._[a],this.writeThrough(),this},b.prototype.set=function(a,b,c){var d;this.clearExpireds(),c==null&&(c=this.timeout),i(c)&&c!==0&&(d=m()+c);try{this._[a]={v:b,e:d||0,t:c},this.writeThrough()}catch(e){this.error(e),b=null}return b},b.prototype.toString=function(){return""+this.namespace+" : "+this.timeout,this},b.prototype.writeThrough=function(){return k(),this},b}(e),d=function(a){function c(a,b,d){var e,f,g;this.namespace=a,this.timeout=b,this.atts=d,this._=(g=(e=this.store)[f=this.namespace])!=null?g:e[f]={},this.logPrefix="MemoryStore",c.__super__.constructor.call(this,this.namespace,this.timeout,this.atts)}var b;return s(c,a),l._kache==null&&(l._kache=b={store:{},enabled:l.KacheConfig.enabled}),c.kache=l._kache,c.clearExpireds=function(){var a,b,c,d,e,f,i;i=this.store;for(c in i){if(!p.call(i,c))continue;f=i[c],e=this.store[c];for(d in e)b=e[d],h(b)&&(a=!0,delete b);a&&(this.store[c]=e,g(this.store[c])===0&&delete this.store[c])}return this},c.clearStore=function(){return this.store={},this},c.disable=function(){return l._kache.enabled=!1,this},c.dumpAll=function(){return this.prototype.log(this.store),this},c.enable=function(){return l._kache.enabled=!0,this},c.isEnabled=function(){return!!(l._kache&&l._kache.enabled||l.KacheConfig&&l.KacheConfig.enabled||!1)},c.validStore=function(){return!0},c.prototype.store=l._kache.store,c.prototype.enabled=function(){return!!c.isEnabled()},c}(f),b=function(a){function c(a,b,d){this.namespace=a,this.timeout=b,this.atts=d;if(!c.validStore())throw"LocalStorage is not a valid cache store";this._=JSON.parse(this.store[this.namespace]||"{}"),this.logPrefix="LocalStore",c.__super__.constructor.call(this,this.namespace,this.timeout,this.atts)}var b;return s(c,a),b="_kache_enabled",c.clearStore=function(){var a;return localStorage[b]!==void 0&&(a=this.isEnabled()),localStorage.clear(),a!==void 0&&(localStorage[b]=a),this},c.clearExpireds=function(){var a,b,c,d,e,f,i;f=this.store;for(d in f){if(!p.call(f,d))continue;e=f[d],i=JSON.parse(e);for(c in i){b=i[c],h(b)&&(a=!0,delete b);if(a&&g(e)===0){delete e;return}e==null&&(e={}),this.store[d]=JSON.stringify(e)}}return this},c.enable=function(){return localStorage[b]="true",this},c.disable=function(){return localStorage[b]="false",this},c.dumpAll=function(){return this.prototype.log(this.store),this},c.isEnabled=function(){return!!(localStorage[b]&&localStorage[b]==="true"||l.KacheConfig&&l.KacheConfig.enabled||!1)},c.validStore=function(){try{return!!localStorage}catch(a){return!1}},c.prototype.store=localStorage,c.prototype.enabled=function(){return!!c.isEnabled()},c.prototype.error=function(a){a==="QUOTA_EXCEEDED_ERR"?(this.log("QUOTA_EXCEEDED_ERR"),this.clearExpireds()):c.__super__.error.call(this,a)},c.prototype.writeThrough=function(){return this.store[this.namespace]=JSON.stringify(this._),this},c}(f),a=b.validStore()?b:d,l.Kache=function(b,c,d){return new a(b,c,d)},l.Kache.Local=b,l.Kache.Memory=d,l.Kache.clearStore=a.clearStore,l.Kache.clearExpireds=a.clearExpireds,l.Kache.disable=a.disable,l.Kache.enable=a.enable,l.Kache.isEnabled=a.isEnabled,l.Kache.__version__=n})).call(this);