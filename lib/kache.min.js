/*
Kache - a cross-browser LocalStorage API
Copyright: Jason Leveille 2012
https://github.com/leveille/kache
License: MIT
*/((function(){var a,b,c,d,e,f,g,h,i,j,k,l,m,n=Object.prototype.hasOwnProperty,o=function(a,b){function d(){this.constructor=a}for(var c in b)n.call(b,c)&&(a[c]=b[c]);return d.prototype=b.prototype,a.prototype=new d,a.__super__=b.prototype,a};j=typeof exports!="undefined"&&exports!==null?exports:this,l="0.0.1",f=function(){return"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,function(a){var b,c;return b=Math.random()*16|0,c=a==="x"?b:b&3|8,c.toString(16)}).toUpperCase()},h=function(a){return typeof a=="number"&&isFinite(a)},g=function(a){return a&&a.e&&a.e<k()},i=function(){},k=function(){return+(new Date)},e=function(a){var b,c,d;d=0;for(b in a){if(!n.call(a,b))continue;c=a[b],d++}return d},j.KacheConfig==null&&(j.KacheConfig={enabled:!1,defaultTimeout:0}),(m=j.KacheConfig).Timeouts==null&&(m.Timeouts={}),d=function(){function a(a,b,c){this.namespace=a,this.timeout=b,this.atts=c;if(!this._)throw"Invalid Cache Instance";j.KacheConfig&&(j.KacheConfig.Timeouts&&j.KacheConfig.Timeouts[this.namespace]?b=j.KacheConfig.Timeouts[this.namespace]:j.KacheConfig.defaultTimeout?b=j.KacheConfig.defaultTimeout:b=0),this.timeout==null&&(this.timeout=b),c&&this.load(c)}return a.prototype.clear=function(){return this._={},this.writeThrough(),this},a.prototype.clearExpired=function(a){return g(this._[a])&&this.remove(a),this},a.prototype.clearExpireds=function(){var a,b,c;c=this._;for(b in c)a=c[b],this.clearExpired(b);return this},a.prototype.count=function(){return this.clearExpireds(),e(this._)},a.prototype.dump=function(){return console.log(this._),this},a.prototype.enabled=function(){throw"NotImplemented exception"},a.prototype.error=function(a){return console.log(a)},a.prototype.get=function(a){if(!this.enabled())return;this.clearExpired(a);if(this._[a]&&this._[a].v)return this._[a].v},a.prototype.load=function(a){var b,c,d;d=[];for(b in a)c=a[b],d.push(this[b]=c);return d},a.prototype.remove=function(a){return delete this._[a],this.writeThrough(),this},a.prototype.set=function(a,b,c){var d;this.clearExpireds(),c==null&&(c=this.timeout),h(c)&&c!==0&&(d=k()+c);try{this._[a]={v:b,e:d||0,t:c},this.writeThrough()}catch(e){this.error(e),b=null}return b},a.prototype.toString=function(){return""+this.namespace+" : "+this.timeout,this},a.prototype.writeThrough=function(){return i(),this},a}(),c=function(a){function c(a,b,d){var e,f,g;this.namespace=a,this.timeout=b,this.atts=d,this._=(g=(e=this.store)[f=this.namespace])!=null?g:e[f]={},c.__super__.constructor.call(this,this.namespace,this.timeout,this.atts)}var b;return o(c,a),j._kache==null&&(j._kache=b={store:{},enabled:j.KacheConfig.enabled}),c.kache=j._kache,c.clearExpireds=function(){var a,b,c,d,f,h,i;i=this.store;for(c in i){if(!n.call(i,c))continue;h=i[c],f=this.store[c];for(d in f)b=f[d],g(b)&&(a=!0,delete b);a&&(this.store[c]=f,e(this.store[c])===0&&delete this.store[c])}return this},c.clearStore=function(){return this.store={},this},c.disable=function(){return j._kache.enabled=!1,this},c.dumpall=function(){return console.log(this.store),this},c.enable=function(){return j._kache.enabled=!0,this},c.isEnabled=function(){return!!(j._kache&&j._kache.enabled||j.KacheConfig&&j.KacheConfig.enabled||!1)},c.validStore=function(){return!0},c.prototype.store=j._kache.store,c.prototype.enabled=function(){return!!c.isEnabled()},c}(d),b=function(a){function c(a,b,d){this.namespace=a,this.timeout=b,this.atts=d;if(!c.validStore())throw"LocalStorage is not a valid cache store";this._=JSON.parse(this.store[this.namespace]||"{}"),c.__super__.constructor.call(this,this.namespace,this.timeout,this.atts)}var b;return o(c,a),b="_kache_enabled",c.clearStore=function(){var a;return localStorage[b]!==void 0&&(a=this.isEnabled()),localStorage.clear(),a!==void 0&&(localStorage[b]=a),this},c.clearExpireds=function(){var a,b,c,d,f,h,i;h=this.store;for(d in h){if(!n.call(h,d))continue;f=h[d],i=JSON.parse(f);for(c in i){b=i[c],g(b)&&(a=!0,delete b);if(a&&e(f)===0){delete f;return}f==null&&(f={}),this.store[d]=JSON.stringify(f)}}return this},c.enable=function(){return localStorage[b]="true",this},c.disable=function(){return localStorage[b]="false",this},c.dumpall=function(){return console.log(this.store),this},c.isEnabled=function(){return!!(localStorage[b]&&localStorage[b]==="true"||j.KacheConfig&&j.KacheConfig.enabled||!1)},c.validStore=function(){try{return!!localStorage}catch(a){return!1}},c.prototype.store=localStorage,c.prototype.enabled=function(){return!!c.isEnabled()},c.prototype.error=function(a){a==="QUOTA_EXCEEDED_ERR"?(console.log("QUOTA_EXCEEDED_ERR"),this.clearExpireds()):c.__super__.error.call(this,a)},c.prototype.writeThrough=function(){return this.store[this.namespace]=JSON.stringify(this._),this},c}(d),a=b.validStore()?b:c,j.Kache=function(b,c,d){return new a(b,c,d)},j.Kache.Guid=f,j.Kache.Local=b,j.Kache.Memory=c,j.Kache.clearStore=a.clearStore,j.Kache.clearExpireds=a.clearExpireds,j.Kache.disable=a.disable,j.Kache.enable=a.enable,j.Kache.isEnabled=a.isEnabled,j.Kache.__version__=l})).call(this);